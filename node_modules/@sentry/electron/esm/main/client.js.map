{"version":3,"file":"client.js","sourceRoot":"","sources":["../../src/main/client.ts"],"names":[],"mappings":"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","sourcesContent":["import { BaseClient, Scope } from '@sentry/core';\nimport { Event, EventHint } from '@sentry/types';\nimport { logger, SyncPromise } from '@sentry/utils';\n\nimport { ElectronClient, ElectronOptions, SDK_NAME } from '../common';\nimport { MainBackend } from './backend';\nimport { addEventDefaults } from './context';\nimport { normalizeEvent } from './normalize';\n\n/** SDK version used in every event. */\n// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\nexport const SDK_VERSION: string = require('../../package.json').version;\n\n/** Frontend implementation for Electron renderer backends. */\nexport class MainClient extends BaseClient<MainBackend, ElectronOptions> implements ElectronClient {\n  /**\n   * Creates a new Electron SDK instance.\n   * @param options Configuration options for this SDK.\n   */\n  public constructor(options: ElectronOptions) {\n    super(MainBackend, options);\n  }\n\n  /**\n   * Uploads a native crash dump (Minidump) to Sentry.\n   *\n   * @param path The relative or absolute path to the minidump.\n   * @param event Optional event payload to attach to the minidump.\n   * @param scope Optional SDK scope used to upload.\n   */\n  public captureMinidump(path: string, event: Event = {}, scope?: Scope): string | undefined {\n    let eventId: string | undefined;\n\n    this._processing += 1;\n\n    event.tags = { event_type: 'native', ...event.tags };\n\n    // We are not calling _processEvent here since we do not have beforeSend for minidump crashes\n    this._prepareEvent(event, scope, undefined).then(\n      finalEvent => {\n        if (finalEvent) {\n          eventId = finalEvent && finalEvent.event_id;\n          this._getBackend().uploadMinidump(path, finalEvent);\n        }\n        this._processing -= 1;\n      },\n      reason => {\n        logger.error(reason);\n        this._processing -= 1;\n      },\n    );\n\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public captureEvent(event: Event, hint?: EventHint, scope?: Scope): string | undefined {\n    event.tags = { event_type: 'javascript', ...event.tags };\n    return super.captureEvent(event, hint, scope);\n  }\n\n  /**\n   * Does nothing in main/node\n   */\n  public showReportDialog(_: unknown): void {\n    // noop\n  }\n\n  /**\n   * @inheritDoc\n   */\n  protected _prepareEvent(event: Event, scope?: Scope, hint?: EventHint): PromiseLike<Event | null> {\n    event.platform = event.platform || 'node';\n    event.sdk = {\n      ...event.sdk,\n      name: SDK_NAME,\n      packages: [\n        ...((event.sdk && event.sdk.packages) || []),\n        {\n          name: 'npm:@sentry/electron',\n          version: SDK_VERSION,\n        },\n      ],\n      version: SDK_VERSION,\n    };\n\n    return super._prepareEvent(event, scope, hint).then((filledEvent: Event | null) =>\n      new SyncPromise<Event>(async resolve => {\n        if (filledEvent) {\n          resolve(normalizeEvent(await addEventDefaults(this._options.appName, filledEvent)));\n        } else {\n          resolve(filledEvent);\n        }\n      }).then((e: Event | null) => e),\n    );\n  }\n}\n"]}